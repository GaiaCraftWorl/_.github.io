<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gaia Craft | Pulseras Artesanales</title>
  <meta name="description" content="Gaia Craft: pulseras artesanales hechas a mano con intenci√≥n, amor y energ√≠a." />

  <link rel="icon" type="image/png" href="faviconemp.png">
  <link rel="shortcut icon" type="image/png" href="faviconemp.PNG?v=3">
  <link rel="apple-touch-icon" href="faviconemp.png">
  <meta name="theme-color" content="#07080a">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f1216;
      --muted:#637083;

      --gold:#d7b46a;
      --gold2:#b28a3f;

      --r: 18px;

      --secGrey:#f2f3f6;
      --secBlack:#07080a;

      --headerH: 78px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:var(--bg)}
    a{text-decoration:none;color:inherit}
    img{display:block;max-width:100%}
    .wrap{width:min(1200px, 92vw); margin: 0 auto;}

    #catalogo, #configurador, #sobre, #contacto{
      scroll-margin-top: calc(var(--headerH) + 14px);
    }

    header{
      position: fixed;
      left: 0; right: 0; top: 0;
      z-index: 50;
      background: rgba(255,255,255,.88);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 12px 0;
      min-height: var(--headerH);
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 240px;
    }
    .brand-logo{
      width: 54px;
      height: 54px;
      border-radius: 14px;
      object-fit: cover;
      border: 1px solid rgba(0,0,0,.08);
      background: #fff;
      box-shadow: 0 12px 28px rgba(0,0,0,.12);
      flex: 0 0 auto;
    }
    .brand-name{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .brand-name strong{
      font-family: Cinzel, serif;
      letter-spacing: 1.4px;
      font-size: 20px;
    }
    .brand-name span{
      font-size: 12.5px;
      color: var(--muted);
      margin-top: 3px;
      font-weight: 600;
    }

    nav{
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .navBtn{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.72);
      box-shadow: 0 10px 22px rgba(0,0,0,.08);
      font-weight: 800;
      font-size: 14px;
      color: #1b1f26;
      transition: transform .08s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease, color .18s ease;
      white-space: nowrap;
      cursor: pointer;
    }
    .navBtn:hover{
      transform: translateY(-1px);
      background: linear-gradient(135deg, rgba(215,180,106,.30), rgba(178,138,63,.14));
      border-color: rgba(215,180,106,.70);
      color: #1a1408;
      box-shadow: 0 18px 44px rgba(0,0,0,.16);
    }

    .navBtn.primary{
      background: linear-gradient(135deg, #111, #252525);
      border-color: #111;
      color: var(--gold);
      box-shadow: 0 18px 44px rgba(0,0,0,.18);
    }
    .navBtn.primary:hover{
      background: linear-gradient(135deg, rgba(215,180,106,.95), rgba(178,138,63,.85));
      border-color: rgba(215,180,106,.95);
      color: #111;
    }

    .menuToggle{
      display:none;
      width: 46px; height: 46px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.85);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      cursor:pointer;
      font-size: 18px;
    }

    .hero{
      min-height: 100svh;
      display:flex;
      align-items:center;
      position: relative;
      padding-top: calc(var(--headerH) + 18px);
      padding-bottom: 44px;
      overflow:hidden;
      background:#0b0b0d;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.70)),
        url("Hero.jpeg") center/cover no-repeat;
      transform: scale(1.02);
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-40% -30% auto auto;
      width: 540px;
      height: 540px;
      background: radial-gradient(circle, rgba(215,180,106,.25), rgba(215,180,106,0) 70%);
      filter: blur(2px);
      pointer-events:none;
      transform: rotate(12deg);
    }

    .heroInner{
      position: relative;
      z-index: 2;
      width: 100%;
      color: #fff;
      text-align:center;
    }
    .heroBox{
      width: min(860px, 92vw);
      margin: 0 auto;
      padding: 22px 22px 20px;
      border-radius: 22px;
      background: rgba(0,0,0,.32);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(8px);
      box-shadow: 0 22px 80px rgba(0,0,0,.35);
    }
    .kicker{
      font-weight: 900;
      letter-spacing: 2.2px;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .heroTitle{
      margin: 0 auto 14px;
      font-size: clamp(38px, 5.2vw, 74px);
      line-height: 1.02;
      font-weight: 900;
      letter-spacing: -1px;
      max-width: 18ch;
      text-shadow: 0 22px 60px rgba(0,0,0,.38);
    }
    .heroText{
      margin: 0 auto 22px;
      max-width: 70ch;
      color: rgba(255,255,255,.88);
      line-height: 1.7;
      font-size: 16px;
    }
    .ctaRow{
      display:flex;
      justify-content:center;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .cta{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 14px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight: 900;
      box-shadow: 0 16px 44px rgba(0,0,0,.25);
      transition: transform .08s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease, color .18s ease;
      min-width: 180px;
    }
    .cta:hover{
      transform: translateY(-1px);
      background: linear-gradient(135deg, rgba(215,180,106,.35), rgba(178,138,63,.12));
      border-color: rgba(215,180,106,.7);
    }
    .cta.primary{
      background: linear-gradient(135deg, rgba(215,180,106,.95), rgba(178,138,63,.85));
      border-color: rgba(215,180,106,.95);
      color:#111;
    }
    .cta.primary:hover{
      box-shadow: 0 22px 60px rgba(0,0,0,.34);
    }

    main{background:#fff;}
    .section{ padding: 62px 0; position: relative; }
    .sectionDivider{ border-top: 1px solid rgba(0,0,0,.08); }
    .section h2{ margin:0 0 10px; font-size: 28px; letter-spacing: -.3px; }
    .section p.lead{ margin:0 0 20px; color: #5d6a7c; line-height:1.7; font-size: 16px; }
    .lead b{color:#1a1408}

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .tile{
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.08);
      background: #f4f6fb;
      aspect-ratio: 1/1;
      box-shadow: 0 14px 34px rgba(0,0,0,.08);
      cursor:pointer;
      position:relative;
      transition: transform .08s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .tile:hover{
      transform: translateY(-2px);
      border-color: rgba(215,180,106,.55);
      box-shadow: 0 20px 48px rgba(0,0,0,.14);
    }
    .tile img{
      width:100%; height:100%;
      object-fit: cover;
      transform: scale(1.03);
      transition: transform .25s ease;
    }
    .tile:hover img{ transform: scale(1.08); }

    .overlay{
      position:absolute; left:0; right:0; bottom:0;
      padding: 12px 12px 10px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      color:#fff;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.72));
    }
    .overlay .name{
      margin:0;
      font-weight: 950;
      font-size: 18px;
      line-height:1.15;
      text-shadow: 0 10px 22px rgba(0,0,0,.40);
    }
    .overlay .price{
      font-weight: 950;
      font-size: 16px;
      color: #f5e5bf;
      text-shadow: 0 10px 22px rgba(0,0,0,.40);
      white-space: nowrap;
    }

    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 18px;
    }
    .card{
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 18px;
      background:#fff;
      box-shadow: 0 14px 34px rgba(0,0,0,.08);
      padding: 18px;
    }
    .card h3{margin:0 0 10px}
    .card p{margin:0;color:#5d6a7c;line-height:1.75}

    .sectionGrey{ background: var(--secGrey); }
    .sectionGrey .card{ background: rgba(255,255,255,.72); border-color: rgba(0,0,0,.07); }

    .sectionBlack{
      background: var(--secBlack);
      color:#fff;
    }
    .sectionBlack h2{color:#fff}
    .sectionBlack p.lead{color: rgba(255,255,255,.72)}
    .sectionBlack .card{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 55px rgba(0,0,0,.35);
    }
    .sectionBlack .card p{ color: rgba(255,255,255,.74); }

    .waBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 14px 18px;
      border-radius: 999px;
      font-weight: 950;
      border: 1px solid rgba(215,180,106,.55);
      background: linear-gradient(135deg, rgba(215,180,106,.95), rgba(178,138,63,.85));
      color: #111;
      box-shadow: 0 18px 55px rgba(0,0,0,.35);
      transition: transform .08s ease, box-shadow .18s ease, filter .18s ease;
    }
    .waBtn:hover{
      transform: translateY(-1px);
      box-shadow: 0 24px 70px rgba(0,0,0,.45);
      filter: brightness(1.02);
    }
    .waNumber{
      margin-top: 12px;
      color: rgba(255,255,255,.78);
      font-weight: 800;
      letter-spacing: .2px;
    }

    footer{
      border-top: 1px solid rgba(255,255,255,.10);
      padding: 24px 0 34px;
      color: rgba(255,255,255,.65);
      font-size: 13px;
      background: var(--secBlack);
    }

    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.45);
      z-index: 60;
    }
    dialog{
      border:0;
      padding:0;
      border-radius: 18px;
      width: min(880px, 94vw);
      box-shadow: 0 22px 80px rgba(0,0,0,.35);
      z-index: 61;
    }
    dialog::backdrop{ background: rgba(0,0,0,.45); }
    .close{
      position:absolute; top:10px; right:10px;
      width: 44px; height: 44px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.10);
      background:#fff;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.12);
      transition: transform .08s ease, box-shadow .18s ease;
    }
    .close:hover{ transform: translateY(-1px); box-shadow: 0 18px 40px rgba(0,0,0,.18); }
    .modalBody{
      display:grid;
      grid-template-columns: 1fr 1fr;
      background:#fff;
    }
    .modalImg{ background:#f4f6fb; min-height: 320px; }
    .modalImg img{ width:100%; height:100%; object-fit: cover; }
    .modalInfo{ padding: 18px; }
    .modalInfo h3{ margin:0 0 8px; font-size: 22px; }
    .modalInfo p{ margin:0 0 12px; color:#5d6a7c; line-height:1.7; }
    .meta{ display:flex; gap: 10px; align-items:center; margin-bottom: 14px; flex-wrap:wrap;}
    .pill{
      font-weight: 950;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background:#fff;
    }
    .tag{
      font-weight: 950;
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(215,180,106,.18);
      color: #2b2416;
      border: 1px solid rgba(215,180,106,.35);
    }

    /* CONFIGURADOR */
    .builder{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      margin-top: 18px;
    }
    .builderTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    /* ‚úÖ REEMPLAZO de "precio + cuentas" por CUADRO DE SECUENCIA */
    .builderSeqBox{
      width: min(360px, 54%);
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.85);
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
      padding: 10px 12px;
    }
    .builderSeqBox .t{
      font-weight: 950;
      font-size: 12px;
      color:#1b1f26;
      margin-bottom: 6px;
      letter-spacing: .2px;
    }
    .builderSeqBox .v{
      font-weight: 900;
      font-size: 13px;
      color:#1a1408;
      line-height:1.35;
      word-break: break-word;
    }
    .builderSeqBox .hint{
      margin-top: 6px;
      font-size: 11.5px;
      color:#5d6a7c;
      line-height:1.4;
      font-weight: 700;
    }

    .builderPreview canvas{
      width:100%;
      height:auto;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.08);
      background: linear-gradient(135deg, rgba(255,255,255,.95), rgba(242,243,246,.95));
      box-shadow: 0 14px 34px rgba(0,0,0,.08);
    }
    .builderNote{ margin: 12px 0 0; color:#5d6a7c; line-height:1.7; }
    .builderSmall{ margin: 12px 0 0; color:#5d6a7c; font-size: 12.5px; line-height:1.6; }

    .fields{ display:grid; gap: 12px; }
    .field label{
      display:block;
      margin-bottom: 8px;
      font-weight: 950;
      font-size: 13px;
      color:#1b1f26;
    }
    .field select,
    .field input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      font-weight: 750;
      color:#1b1f26;
      outline: none;
    }
    .field select:focus,
    .field input:focus{
      border-color: rgba(215,180,106,.75);
      box-shadow: 0 0 0 4px rgba(215,180,106,.18);
    }
    .rangeRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    input[type="range"]{ width:100%; }

    .builderBtns{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 14px;
    }
    .builderBtns .navBtn{ flex: 1 1 140px; text-align:center; }

    @media (max-width: 920px){
      :root{ --headerH: 72px; }
      .menuToggle{display:inline-flex; align-items:center; justify-content:center;}
      nav{display:none}
      .heroInner{text-align:left}
      .heroBox{ padding: 18px; }
      .heroTitle{ max-width: 18ch; font-size: clamp(34px, 7vw, 52px); }
      .ctaRow{justify-content:flex-start}
      .grid{grid-template-columns: repeat(2, 1fr)}
      .twoCol{grid-template-columns: 1fr}
      .modalBody{grid-template-columns: 1fr}
      .overlay .name{font-size:17px}
      .overlay .price{font-size:15px}
      .builder{ grid-template-columns: 1fr; }
      .builderSeqBox{ width: 100%; }
    }

    @media (max-width: 520px){
      :root{ --headerH: 68px; }
      .wrap{width: min(1100px, 92vw);}
      .topbar{padding: 10px 0;}
      .brand{min-width: unset;}
      .brand-logo{width: 48px; height: 48px;}
      .brand-name strong{font-size: 18px;}
      .brand-name span{display:none;}
      .hero{ padding-top: calc(var(--headerH) + 14px); }
      .hero::before{ background-position: 55% center; }
      .heroBox{ width: 92vw; padding: 16px; border-radius: 18px; }
      .kicker{font-size: 11px; letter-spacing: 1.8px;}
      .heroText{font-size: 15px}
      .ctaRow{ flex-direction: column; gap: 10px; }
      .cta{ width: 100%; min-width: unset; }
      .grid{grid-template-columns: 1fr}
    }

    .mobileNav{
      position: fixed;
      top: calc(var(--headerH) + 10px);
      right: 4vw;
      left: 4vw;
      z-index: 80;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 60px rgba(0,0,0,.18);
      padding: 12px;
      display:none;
    }
    .mobileNav a{display:block; text-align:center; margin: 8px 0;}
    .mobileNav.show{display:block}
  </style>
</head>

<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <img class="brand-logo" src="LogoEmp.jpeg" alt="Logo Gaia Craft">
        <div class="brand-name">
          <strong>GAIA CRAFT</strong>
          <span>Pulseras artesanales ‚Ä¢ amor & energ√≠a ‚ú®</span>
        </div>
      </div>

      <button class="menuToggle" id="menuToggle" aria-label="Abrir men√∫">‚ò∞</button>

      <nav aria-label="Navegaci√≥n">
        <a class="navBtn" href="#catalogo">Cat√°logo</a>
        <a class="navBtn" href="#configurador">Crea tu pulsera</a>
        <a class="navBtn" href="#sobre">Sobre</a>
        <a class="navBtn" href="#contacto">Contacto</a>
        <a class="navBtn primary" href="#catalogo">Ver productos</a>
      </nav>
    </div>
  </header>

  <div class="mobileNav" id="mobileNav">
    <a class="navBtn" href="#catalogo">Cat√°logo</a>
    <a class="navBtn" href="#configurador">Crea tu pulsera</a>
    <a class="navBtn" href="#sobre">Sobre</a>
    <a class="navBtn" href="#contacto">Contacto</a>
    <a class="navBtn primary" href="#catalogo">Ver productos</a>
  </div>

  <section class="hero" id="inicio">
    <div class="wrap heroInner">
      <div class="heroBox">
        <div class="kicker">PULSERAS ‚Ä¢ ARTESANAL ‚Ä¢ PER√ö</div>
        <h1 class="heroTitle">Descubre tu energ√≠a con estilo</h1>
        <p class="heroText">
          Dise√±os artesanales inspirados en la naturaleza. Mira el cat√°logo, arma tu pulsera personalizada y compra directo por WhatsApp.
        </p>

        <div class="ctaRow">
          <a class="cta primary" href="#catalogo">Ver cat√°logo</a>
          <a class="cta" href="#configurador">Crear mi pulsera</a>
          <a class="cta" id="waTop" href="#" target="_blank" rel="noopener">Comprar por WhatsApp</a>
        </div>
      </div>
    </div>
  </section>

  <main>
    <section id="catalogo" class="section sectionDivider">
      <div class="wrap">
        <h2>Cat√°logo</h2>
        <p class="lead">
          üî• <b>¬°Ya sali√≥ nuestro primer lanzamiento!</b> Con ustedes: <b>Eclipse Azul</b>.
          Dale click para ver detalles y si te vacila, la compras directo por WhatsApp. üòÆ‚Äçüí®‚ú®
          <br><br>
          Y ojo‚Ä¶ <b>ya se vienen m√°s dise√±os</b> üëÄ
        </p>

        <div id="grid" class="grid"></div>
      </div>
    </section>

    <!-- CREA TU PULSERA -->
    <section id="configurador" class="section sectionGrey sectionDivider">
      <div class="wrap">
        <h2>Crea tu pulsera</h2>
        <p class="lead">
          <b>TEXTURAS v2:</b> cada cuenta se dibuja usando <b>la imagen real</b> (cover + brillo suave), no colores planos.
        </p>

        <div class="builder">
          <div class="card builderPreview">
            <div class="builderTop">
              <div>
                <h3 style="margin:0 0 6px">Vista previa</h3>
                <p class="builderSmall" style="margin:0">Pulsera renderizada con <b>IM√ÅGENES</b> (texturas v2).</p>
              </div>

              <!-- ‚úÖ AQU√ç se reemplaz√≥ "cantas+precio" por el cuadro de secuencia -->
              <div class="builderSeqBox" aria-label="Secuencia activa">
                <div class="t">Secuencia activa</div>
                <div class="v" id="bSeqPreview">Auto (principal + acento)</div>
                <div class="hint">Escribe una secuencia abajo y se repite alrededor de la pulsera.</div>
              </div>
            </div>

            <canvas id="braceletCanvas" width="520" height="520" aria-label="Vista previa de pulsera"></canvas>

            <p class="builderNote" id="bSummary"></p>
            <p class="builderSmall" id="bPricing"></p>
            <p class="builderSmall" id="texStatus"></p>
          </div>

          <div class="card builderControls">
            <h3 style="margin:0 0 12px">Personaliza</h3>

            <div class="fields">
              <!-- ‚úÖ NUEVO: SECUENCIA -->
              <div class="field">
                <label for="bSequence">Secuencia de piedras (opcional)</label>
                <input id="bSequence" type="text" maxlength="140"
                  placeholder="Ej: √ìnix Negro, Cuarzo Blanco, √ìnix Negro">
                <p class="builderSmall" style="margin:8px 0 0">
                  Separar con <b>comas</b> o <b>|</b>. Si escribes secuencia, se usa ese orden y se repite.
                  <br>Ej: <b>Onix Negro | Cuarzo Blanco | Onix Negro</b>
                </p>
              </div>

              <div class="field">
                <label for="bMainStone">Piedra principal</label>
                <select id="bMainStone"></select>
              </div>

              <div class="field">
                <label for="bAccentStone">Acento (opcional)</label>
                <select id="bAccentStone"></select>
              </div>

              <div class="field">
                <div class="rangeRow">
                  <label for="bAccentPercent" style="margin:0">Cantidad de acento</label>
                  <span class="pill" id="bAccentLabel">0%</span>
                </div>
                <input id="bAccentPercent" type="range" min="0" max="40" step="5" value="15">
              </div>

              <div class="field">
                <label for="bBeadSize">Tama√±o de cuentas</label>
                <select id="bBeadSize">
                  <option value="4">4 mm</option>
                  <option value="6">6 mm</option>
                  <option value="8">8 mm</option>
                </select>
              </div>

              <div class="field">
                <label for="bLength">Largo de pulsera</label>
                <select id="bLength">
                  <option value="16">16 cm</option>
                  <option value="17">17 cm</option>
                  <option value="18" selected>18 cm</option>
                  <option value="19">19 cm</option>
                  <option value="20">20 cm</option>
                  <option value="21">21 cm</option>
                  <option value="22">22 cm</option>
                </select>
              </div>

              <div class="field">
                <label for="bSpacer">Separadores</label>
                <select id="bSpacer">
                  <option value="none" selected>Sin separadores</option>
                  <option value="gold">Dorado</option>
                  <option value="silver">Plateado</option>
                </select>
              </div>

              <div class="field">
                <label for="bNote">Nota (opcional)</label>
                <input id="bNote" type="text" maxlength="80" placeholder="Ej: para regalo, estilo minimalista, etc.">
              </div>
            </div>

            <div class="builderBtns">
              <button class="navBtn" id="bRandom" type="button">Aleatorio</button>
              <button class="navBtn" id="bReset" type="button">Reset</button>
              <a class="navBtn primary" id="bWA" href="#" target="_blank" rel="noopener">Pedir por WhatsApp</a>
            </div>

            <p class="builderSmall">
              * El precio se calcula por <b>tiras</b>: <b>S/20</b> por tira y <b>65 cuentas</b> por tira.
              Si usas 2 piedras diferentes, se considera que necesitas comprar <b>tira por cada piedra</b> (m√°s caro).
              <br>
              * La ganancia es <b>18%</b> del costo total, y se suma al final.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="sobre" class="section sectionGrey sectionDivider">
      <div class="wrap">
        <h2>Sobre nosotros</h2>
        <p class="lead">Prop√≥sito, intenci√≥n y detalle en cada pieza.</p>

        <div class="twoCol">
          <div class="card">
            <h3>Objetivo</h3>
            <p>
              Crear pulseras artesanales que conecten lo material con lo espiritual, combinando una est√©tica fina y moderna
              con el significado de cada detalle. Buscamos que cada pieza sea un s√≠mbolo de intenci√≥n:
              calma, protecci√≥n, enfoque y energ√≠a personal.
              <br><br>
              Nuestro objetivo es que elijas una pulsera que represente tu estilo y, al mismo tiempo, tu esencia.
              Piezas hechas a mano con dedicaci√≥n, listas para acompa√±arte d√≠a a d√≠a.
            </p>
          </div>

          <div class="card">
            <h3>Misi√≥n</h3>
            <p>
              Dise√±ar y elaborar piezas hechas a mano con amor, precisi√≥n y un acabado elegante, inspiradas en la naturaleza
              y en la energ√≠a personal. Seleccionamos materiales con intenci√≥n y cuidamos cada etapa: desde el dise√±o, la
              combinaci√≥n de colores, hasta el armado final.
              <br><br>
              Nuestra misi√≥n es que Gaia Craft se sienta como un detalle especial: una pulsera que eleve tu look, pero
              tambi√©n te recuerde lo que quieres atraer, fortalecer o proteger.
            </p>
          </div>
        </div>
      </div>
    </section>

    <section id="contacto" class="section sectionBlack sectionDivider">
      <div class="wrap">
        <h2>Contacto</h2>
        <p class="lead">Ventas y coordinaci√≥n de pedidos. Respuesta r√°pida por WhatsApp.</p>

        <div class="twoCol">
          <div class="card">
            <h3>WhatsApp</h3>
            <p>
              Escr√≠benos para precios, personalizaci√≥n (colores/piedras) y stock disponible.
              Te asesoramos para que elijas la pulsera ideal.
            </p>

            <div style="margin-top:14px">
              <a class="waBtn" id="waBottom" href="#" target="_blank" rel="noopener">
                Escribir por WhatsApp
              </a>
            </div>

            <div class="waNumber">+51 903 534 944</div>
          </div>

          <div class="card">
            <h3>Env√≠os</h3>
            <p>
              Somos de <strong>Arequipa</strong> y realizamos env√≠os a <strong>todo el Per√∫</strong>.
              Coordinamos por WhatsApp el m√©todo de env√≠o, tiempos estimados y costo seg√∫n tu ciudad.
              <br><br>
              Tambi√©n puedes recoger tu pedido en Arequipa (previa coordinaci√≥n).
            </p>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="wrap">
        ¬© <span id="year"></span> Gaia Craft
      </div>
    </footer>
  </main>

  <div id="backdrop" class="backdrop" hidden></div>
  <dialog id="modal">
    <button id="closeModal" class="close" aria-label="Cerrar">‚úï</button>

    <div class="modalBody">
      <div class="modalImg">
        <img id="mImg" alt="">
      </div>
      <div class="modalInfo">
        <h3 id="mTitle"></h3>
        <p id="mDesc"></p>

        <div class="meta">
          <span id="mPrice" class="pill"></span>
          <span id="mTag" class="tag"></span>
        </div>

        <a id="mWA" class="cta primary" href="#" target="_blank" rel="noopener" style="width:100%;justify-content:center;">
          Comprar por WhatsApp
        </a>
      </div>
    </div>
  </dialog>

  <script>
    const WHATSAPP_NUMBER = "51903534944";

    function comingSoonDataURI(){
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#f3f4f7"/>
              <stop offset="55%" stop-color="#efe7d6"/>
              <stop offset="100%" stop-color="#f7f7fb"/>
            </linearGradient>
          </defs>
          <rect width="1200" height="1200" fill="url(#g)"/>
          <circle cx="600" cy="520" r="240" fill="rgba(215,180,106,.18)"/>
          <text x="600" y="600" text-anchor="middle"
                font-family="Inter, Arial" font-size="68" font-weight="900"
                fill="#1a1a1a" opacity=".88">Pr√≥ximamente</text>
          <text x="600" y="680" text-anchor="middle"
                font-family="Inter, Arial" font-size="30" font-weight="800"
                fill="#5f6b7a">Nuevo dise√±o en camino</text>
        </svg>`;
      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    /* =========================
       CAT√ÅLOGO
       ========================= */
    const PRODUCTS = [
      {
        id: "gc-001",
        nombre: "Eclipse Azul",
        precio: 40,
        tag: "Disponible",
        descripcion:
          "Eclipse Azul ‚Äî Pulsera de Ojo de Tigre Azul üíô‚ú®" +
          "<br><br><strong>Incluye:</strong><br>‚Ä¢ Cajita GaiaCraft<br>‚Ä¢ Bolsa junto con la pulsera",
        img: "Eclipzu.jpeg"
      },
      {
        id: "gc-002",
        nombre: "Sol Interior",
        precio: 80,
        tag: "Disponible",
        descripcion:
          "Sol Interior ‚Äî Citrino ‚ú® + √ìnix Negro ‚ö´." +
          "<br><br><strong>Incluye:</strong><br>‚Ä¢ Cajita GaiaCraft<br>‚Ä¢ Bolsa junto con la pulsera",
        img: "SolInterior.jpeg"
      },
      {
        id: "gc-003",
        nombre: "Pr√≥ximamente",
        precio: 0,
        tag: "Nuevo",
        descripcion: "Este dise√±o se publica pronto. Escr√≠benos por WhatsApp para enterarte primero.",
        img: comingSoonDataURI()
      }
    ];

    const grid = document.getElementById("grid");

    const modal = document.getElementById("modal");
    const backdrop = document.getElementById("backdrop");
    const closeBtn = document.getElementById("closeModal");

    const mImg = document.getElementById("mImg");
    const mTitle = document.getElementById("mTitle");
    const mDesc = document.getElementById("mDesc");
    const mPrice = document.getElementById("mPrice");
    const mTag = document.getElementById("mTag");
    const mWA = document.getElementById("mWA");

    const waTop = document.getElementById("waTop");
    const waBottom = document.getElementById("waBottom");

    const menuToggle = document.getElementById("menuToggle");
    const mobileNav = document.getElementById("mobileNav");

    document.getElementById("year").textContent = new Date().getFullYear();

    function waLink(message){
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
    }
    function setGenericWA(){
      const msg="Hola üòä Estoy interesado/a en pulseras de Gaia Craft. ¬øMe compartes el cat√°logo?";
      const link=waLink(msg);
      waTop.href = link;
      waBottom.href = link;
    }
    function money(v){
      if(Number(v) === 0) return "Precio: consultar";
      return `S/ ${Number(v).toFixed(2)}`;
    }

    function createTile(p){
      const b = document.createElement("button");
      b.className = "tile";
      b.type = "button";
      b.setAttribute("aria-label", `Ver ${p.nombre}`);

      const img = document.createElement("img");
      img.loading = "lazy";
      img.src = p.img;
      img.alt = p.nombre;

      const ov = document.createElement("div");
      ov.className = "overlay";

      const name = document.createElement("p");
      name.className = "name";
      name.textContent = p.nombre;

      const price = document.createElement("span");
      price.className = "price";
      price.textContent = money(p.precio);

      ov.appendChild(name);
      ov.appendChild(price);

      b.appendChild(img);
      b.appendChild(ov);
      b.addEventListener("click", () => openProduct(p));
      return b;
    }

    function openProduct(p){
      mImg.src = p.img;
      mImg.alt = p.nombre;
      mTitle.textContent = p.nombre;
      mDesc.innerHTML = p.descripcion;

      mPrice.textContent = money(p.precio);
      mTag.textContent = p.tag;

      const msg = `Hola üòä Me interesa: ${p.nombre} (ID: ${p.id}). ${money(p.precio)}. ¬øHay stock y opciones?`;
      mWA.href = waLink(msg);

      if(typeof modal.showModal === "function") modal.showModal();
      backdrop.hidden = false;
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      if(typeof modal.close === "function") modal.close();
      backdrop.hidden = true;
      document.body.style.overflow = "";
    }

    closeBtn.addEventListener("click", closeModal);
    backdrop.addEventListener("click", closeModal);
    document.addEventListener("keydown",(e)=>{ if(e.key==="Escape" && !backdrop.hidden) closeModal(); });

    function render(){
      grid.innerHTML = "";
      PRODUCTS.forEach(p => grid.appendChild(createTile(p)));
    }

    function closeMobile(){ mobileNav.classList.remove("show"); }
    menuToggle.addEventListener("click", ()=>{ mobileNav.classList.toggle("show"); });
    mobileNav.querySelectorAll("a").forEach(a=>{ a.addEventListener("click", closeMobile); });
    window.addEventListener("scroll", ()=>{ if(mobileNav.classList.contains("show")) closeMobile(); });

    setGenericWA();
    render();

    /* ==========================================================
       CONFIGURADOR (SECUENCIA + PRECIO POR TIRAS)
       ========================================================== */

    /*
      ‚úÖ NOMBRES EXACTOS de tus archivos:
      Piedras:
      otigrea.jpg
      onixn.jpg
      citrin.jpg
      jade.jpg
      cuarbla.jpg
      agared.jpg
      amat.jpg
      volcanicpiedra.jpg

      Separadores:
      dor.jpg
      plat.jpg
    */
    const ASSET_DIR = ""; // si los pones en una carpeta: "assets/"

    // ‚úÖ Precio por tira y cu√°ntas cuentas vienen
    // Si alguna piedra cuesta distinto, cambia "strandPrice" en esa piedra.
    const BEADS_PER_STRAND = 65;
    const DEFAULT_STRAND_PRICE = 20; // S/ por tira (seg√∫n lo que dijiste)
    const PROFIT_RATE = 0.18;        // 18% de ganancia
    const ROUND_TO = 1;              // redondeo final (1 = 1 sol, 5 = de 5 en 5)

    const STONES = [
      { id:"blue_tiger", name:"Ojo de Tigre Azul", img: ASSET_DIR + "otigrea.jpg", fallback:"#2e5f93", strandPrice: DEFAULT_STRAND_PRICE, aliases:["ojo de tigre azul","tigre azul","otigrea","blue tiger"] },
      { id:"onyx",      name:"√ìnix Negro",        img: ASSET_DIR + "onixn.jpg",   fallback:"#14171c", strandPrice: DEFAULT_STRAND_PRICE, aliases:["onix negro","√≥nix negro","onyx negro","onix","onyx","onixn"] },
      { id:"citrine",   name:"Citrino",           img: ASSET_DIR + "citrin.jpg",  fallback:"#d7b46a", strandPrice: DEFAULT_STRAND_PRICE, aliases:["citrino","citrine","citrin"] },
      { id:"jade",      name:"Jade",              img: ASSET_DIR + "jade.jpg",    fallback:"#2f8a6a", strandPrice: DEFAULT_STRAND_PRICE, aliases:["jade"] },
      { id:"white_q",   name:"Cuarzo Blanco",     img: ASSET_DIR + "cuarbla.jpg", fallback:"#e9eef7", strandPrice: DEFAULT_STRAND_PRICE, aliases:["cuarzo blanco","cuarzo","white quartz","cuarbla"] },
      { id:"red_agate", name:"√Ågata Roja",        img: ASSET_DIR + "agared.jpg",  fallback:"#b3392f", strandPrice: DEFAULT_STRAND_PRICE, aliases:["agata roja","√°gata roja","agata","agate","agared"] },
      { id:"amethyst",  name:"Amatista",          img: ASSET_DIR + "amat.jpg",    fallback:"#6b44c6", strandPrice: DEFAULT_STRAND_PRICE, aliases:["amatista","amethyst","amat"] },
      { id:"lava",      name:"Piedra Volc√°nica",  img: ASSET_DIR + "volcanicpiedra.jpg", fallback:"#2b2b2b", strandPrice: DEFAULT_STRAND_PRICE, aliases:["piedra volcanica","piedra volc√°nica","volcanica","volc√°nica","lava","volcanic","volcanicpiedra"] }
    ];

    const SPACERS = {
      none:   { name:"Sin separadores", img:null, unitCost:0, fallback:"#ffffff" },
      gold:   { name:"Dorado",          img: ASSET_DIR + "dor.jpg",  unitCost:1.2, fallback:"#d7b46a" },
      silver: { name:"Plateado",        img: ASSET_DIR + "plat.jpg", unitCost:1.0, fallback:"#bfc7d6" }
    };

    const BUILDER = {
      spacerEvery: 6,
      laborCost: 0,            // si quieres sumar mano de obra, pon aqu√≠ (ej: 10, 15, 18, etc.)
      extraCost: 0             // extras (hilo/el√°stico/empaque) si quieres
    };

    // refs UI
    const bSequence = document.getElementById("bSequence");
    const bSeqPreview = document.getElementById("bSeqPreview");

    const bMainStone = document.getElementById("bMainStone");
    const bAccentStone = document.getElementById("bAccentStone");
    const bAccentPercent = document.getElementById("bAccentPercent");
    const bAccentLabel = document.getElementById("bAccentLabel");
    const bBeadSize = document.getElementById("bBeadSize");
    const bLength = document.getElementById("bLength");
    const bSpacer = document.getElementById("bSpacer");
    const bNote = document.getElementById("bNote");

    const bSummary = document.getElementById("bSummary");
    const bPricing = document.getElementById("bPricing");
    const bWA = document.getElementById("bWA");
    const bRandom = document.getElementById("bRandom");
    const bReset = document.getElementById("bReset");
    const texStatus = document.getElementById("texStatus");

    // canvas
    const braceletCanvas = document.getElementById("braceletCanvas");
    const ctxB = braceletCanvas.getContext("2d", { alpha: true });
    ctxB.imageSmoothingEnabled = true;

    // cache de im√°genes
    const TEXTURES = new Map();  // key -> Image
    const MISSING = new Set();   // srcs que fallaron

    function loadImage(src){
      return new Promise((resolve) => {
        if(!src) return resolve(null);
        const img = new Image();
        img.decoding = "async";
        img.src = src;
        img.onload = () => resolve(img);
        img.onerror = () => resolve(null);
      });
    }

    async function preloadTextures(){
      MISSING.clear();
      const jobs = [];

      for(const s of STONES){
        jobs.push(loadImage(s.img).then(img=>{
          if(img) TEXTURES.set(`stone:${s.id}`, img);
          else MISSING.add(s.img);
        }));
      }

      for(const [k, v] of Object.entries(SPACERS)){
        if(!v.img) continue;
        jobs.push(loadImage(v.img).then(img=>{
          if(img) TEXTURES.set(`spacer:${k}`, img);
          else MISSING.add(v.img);
        }));
      }

      await Promise.all(jobs);
      updateTextureStatus();
      builderUpdate();
    }

    function updateTextureStatus(){
      if(MISSING.size === 0){
        texStatus.innerHTML = `‚úÖ Texturas cargadas.`;
      } else {
        const list = Array.from(MISSING).map(s=>`<code>${s}</code>`).join(", ");
        texStatus.innerHTML = `‚ö†Ô∏è No cargaron: ${list} <br>Revisa nombres/ruta (ASSET_DIR).`;
      }
    }

    function fillStoneSelect(select, { includeNone=false } = {}){
      select.innerHTML = "";
      if(includeNone){
        const o = document.createElement("option");
        o.value = "none";
        o.textContent = "Sin acento";
        select.appendChild(o);
      }
      STONES.forEach(s=>{
        const o = document.createElement("option");
        o.value = s.id;
        o.textContent = s.name;
        select.appendChild(o);
      });
    }

    fillStoneSelect(bMainStone);
    fillStoneSelect(bAccentStone, { includeNone:true });

    // defaults
    bMainStone.value = "blue_tiger";
    bAccentStone.value = "none";
    bAccentPercent.value = "15";
    bSpacer.value = "none";
    bBeadSize.value = "4";
    bLength.value = "18";

    function getStone(id){
      return STONES.find(s=>s.id===id) || STONES[0];
    }

    function estimateBeadCount(lengthCm, beadMm){
      const raw = (Number(lengthCm) * 10) / (Number(beadMm) * 1.08);
      return Math.max(18, Math.round(raw));
    }

    function getSpacerCount(total, spacerEvery){
      return Math.floor((total - 1) / spacerEvery) + 1;
    }

    /* ========= SECUENCIA: parse robusto ========= */
    function normalizeText(s){
      return (s || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g,"")
        .replace(/\s+/g," ")
        .trim();
    }

    const STONE_ALIAS_MAP = new Map();
    (function buildAliasMap(){
      for(const s of STONES){
        const base = normalizeText(s.name);
        if(base) STONE_ALIAS_MAP.set(base, s.id);

        (s.aliases || []).forEach(a=>{
          const k = normalizeText(a);
          if(k) STONE_ALIAS_MAP.set(k, s.id);
        });

        // permitir id
        STONE_ALIAS_MAP.set(normalizeText(s.id), s.id);
      }
    })();

    function resolveStoneId(token){
      const t = normalizeText(token);
      return STONE_ALIAS_MAP.get(t) || null;
    }

    function parseSequenceInput(raw){
      raw = (raw || "").trim();
      if(!raw) return [];

      // si hay separadores claros, split directo
      if(/[,\|\;\n]/.test(raw)){
        const parts = raw.split(/[,|;\n]+/).map(s=>s.trim()).filter(Boolean);
        const out = [];
        for(const p of parts){
          const id = resolveStoneId(p);
          if(id) out.push(id);
        }
        return out;
      }

      // sin separadores: greedy match de aliases (para "onix negro cuarzo blanco onix negro")
      let rest = normalizeText(raw);
      const aliases = Array.from(STONE_ALIAS_MAP.keys())
        .sort((a,b)=>b.length-a.length); // primero los m√°s largos

      const out = [];
      let guard = 0;

      while(rest && guard < 80){
        guard++;
        let matched = false;

        for(const al of aliases){
          if(rest === al || rest.startsWith(al + " ")){
            out.push(STONE_ALIAS_MAP.get(al));
            rest = rest.slice(al.length).trim();
            matched = true;
            break;
          }
        }

        if(!matched){
          const sp = rest.indexOf(" ");
          if(sp === -1) break;
          rest = rest.slice(sp + 1).trim();
        }
      }

      return out;
    }

    function sequenceToLabel(seqIds){
      if(!seqIds || seqIds.length === 0) return "Auto (principal + acento)";
      const names = seqIds.map(id=>getStone(id).name);
      return names.join(" ‚Üí ");
    }

    /* ========= Rendering bead image ========= */
    function drawBeadImage(x, y, r, img, fallbackColor){
      // sombra suave
      ctxB.beginPath();
      ctxB.arc(x+2, y+3, r, 0, Math.PI*2);
      ctxB.fillStyle = "rgba(0,0,0,.16)";
      ctxB.fill();

      // recorte circular
      ctxB.save();
      ctxB.beginPath();
      ctxB.arc(x, y, r, 0, Math.PI*2);
      ctxB.closePath();
      ctxB.clip();

      if(img){
        // "cover"
        const BEAD_ZOOM = 1.35;
        const scale = BEAD_ZOOM * Math.max((2*r)/img.width, (2*r)/img.height);
        const dw = img.width * scale;
        const dh = img.height * scale;
        ctxB.drawImage(img, x - dw/2, y - dh/2, dw, dh);
      } else {
        ctxB.fillStyle = fallbackColor || "#cfd6e2";
        ctxB.fillRect(x - r, y - r, r*2, r*2);
      }

      ctxB.restore();

      // borde
      ctxB.beginPath();
      ctxB.arc(x, y, r, 0, Math.PI*2);
      ctxB.strokeStyle = "rgba(0,0,0,.10)";
      ctxB.lineWidth = 1;
      ctxB.stroke();
    }

    function renderBracelet({ total, beadMm, plan, spacerKey }){
      const w = braceletCanvas.width;
      const h = braceletCanvas.height;
      const cx = w/2;
      const cy = h/2;

      ctxB.clearRect(0,0,w,h);

      // fondo
      const bg = ctxB.createRadialGradient(cx, cy, 10, cx, cy, w*0.55);
      bg.addColorStop(0, "rgba(255,255,255,1)");
      bg.addColorStop(1, "rgba(242,243,246,1)");
      ctxB.fillStyle = bg;
      ctxB.fillRect(0,0,w,h);

      const scale = w / 520;
      const rMap = {4:14, 6:18, 8:22};
      const beadR = (rMap[Number(beadMm)] || 18) * scale;
      const ringR = (w * 0.33);

      const spacer = SPACERS[spacerKey] || SPACERS.none;
      const spacerImg = spacerKey !== "none" ? (TEXTURES.get(`spacer:${spacerKey}`) || null) : null;

      for(let i=0;i<total;i++){
        const a = (Math.PI * 2) * (i / total) - Math.PI/2;
        const x = cx + ringR * Math.cos(a);
        const y = cy + ringR * Math.sin(a);

        const item = plan[i];
        let img = null;
        let fallback = "#cfd6e2";

        if(item.kind === "spacer"){
          img = spacerImg;
          fallback = spacer.fallback;
        } else {
          const stone = getStone(item.stoneId);
          img = TEXTURES.get(`stone:${stone.id}`) || null;
          fallback = stone.fallback;
        }

        drawBeadImage(x, y, beadR, img, fallback);
      }

      // agujero centro
      ctxB.beginPath();
      ctxB.arc(cx, cy, w*0.12, 0, Math.PI*2);
      ctxB.fillStyle = "rgba(0,0,0,.04)";
      ctxB.fill();
    }

    function buildAccentMask(total, accentCount, spacerEvery, spacerActive){
      const mask = new Array(total).fill(false);
      if(accentCount <= 0) return mask;

      const available = [];
      for(let i=0;i<total;i++){
        if(spacerActive && i % spacerEvery === 0) continue;
        available.push(i);
      }
      if(available.length === 0) return mask;

      accentCount = Math.min(accentCount, available.length);
      const step = available.length / accentCount;

      const used = new Set();
      for(let k=0;k<accentCount;k++){
        let idx = Math.round(k * step);
        if(idx >= available.length) idx = available.length - 1;

        let tries = 0;
        while(used.has(available[idx]) && tries < available.length){
          idx = (idx + 1) % available.length;
          tries++;
        }
        used.add(available[idx]);
        mask[available[idx]] = true;
      }
      return mask;
    }

    function roundTo(value, step){
      const s = Number(step) || 1;
      return Math.round(value / s) * s;
    }

    function builderUpdate(){
      const beadMm = Number(bBeadSize.value);
      const lengthCm = Number(bLength.value);
      const spacerKey = bSpacer.value;

      const total = estimateBeadCount(lengthCm, beadMm);
      const spacerActive = spacerKey !== "none";
      const spacerCount = spacerActive ? getSpacerCount(total, BUILDER.spacerEvery) : 0;
      const baseCount = Math.max(0, total - spacerCount);

      // === SECUENCIA (si existe, manda) ===
      const seqIds = parseSequenceInput(bSequence.value);
      const sequenceActive = seqIds.length > 0;

      bSeqPreview.textContent = sequenceToLabel(seqIds);

      // si hay secuencia, bloquea principal/acento (para no confundir)
      bMainStone.disabled = sequenceActive;
      bAccentStone.disabled = sequenceActive;
      bAccentPercent.disabled = sequenceActive || (bAccentStone.value === "none");

      const main = getStone(bMainStone.value);
      const accentId = bAccentStone.value;
      const accent = (accentId !== "none") ? getStone(accentId) : null;

      const accentOn = !!accent && !sequenceActive;
      const accentPct = Number(bAccentPercent.value);
      const accentPctEff = accentOn ? accentPct : 0;

      bAccentLabel.textContent = `${accentPctEff}%`;

      const accentCount = accentOn ? Math.round(baseCount * (accentPctEff/100)) : 0;
      const mainCount = Math.max(0, baseCount - accentCount);
      const accentMask = accentOn ? buildAccentMask(total, accentCount, BUILDER.spacerEvery, spacerActive) : new Array(total).fill(false);

      // === construir PLAN (orden real de cuentas) ===
      const plan = new Array(total);
      let baseIdx = 0;

      for(let i=0;i<total;i++){
        if(spacerActive && i % BUILDER.spacerEvery === 0){
          plan[i] = { kind:"spacer", spacerKey };
          continue;
        }

        if(sequenceActive){
          const stoneId = seqIds[baseIdx % seqIds.length];
          plan[i] = { kind:"stone", stoneId };
          baseIdx++;
        } else {
          if(accent && accentMask[i]){
            plan[i] = { kind:"stone", stoneId: accent.id };
          } else {
            plan[i] = { kind:"stone", stoneId: main.id };
          }
          baseIdx++;
        }
      }

      // === conteo por piedra (material usado) ===
      const stoneCounts = new Map();
      let spacerUsed = 0;

      for(const item of plan){
        if(item.kind === "spacer"){
          spacerUsed++;
        } else {
          stoneCounts.set(item.stoneId, (stoneCounts.get(item.stoneId) || 0) + 1);
        }
      }

      // === COSTO por TIRAS (65 cuentas por tira) ===
      // si usas varias piedras, se calcula tira por piedra (m√°s caro).
      let materialCost = 0;
      const detailLines = [];

      for(const [stoneId, cnt] of stoneCounts.entries()){
        const st = getStone(stoneId);
        const strands = Math.ceil(cnt / BEADS_PER_STRAND);
        const cost = strands * Number(st.strandPrice || DEFAULT_STRAND_PRICE);
        materialCost += cost;
        detailLines.push(`‚Ä¢ ${st.name}: ${cnt} cuentas ‚Üí ${strands} tira(s) = S/ ${cost.toFixed(2)}`);
      }

      const spacerUnit = SPACERS[spacerKey]?.unitCost || 0;
      const spacerCost = spacerUsed * spacerUnit;
      if(spacerCost > 0){
        materialCost += spacerCost;
        detailLines.push(`‚Ä¢ Separadores (${SPACERS[spacerKey].name}): ${spacerUsed} √ó S/ ${spacerUnit.toFixed(2)} = S/ ${spacerCost.toFixed(2)}`);
      }

      const extraCost = Number(BUILDER.extraCost || 0);
      if(extraCost > 0){
        materialCost += extraCost;
        detailLines.push(`‚Ä¢ Extras: S/ ${extraCost.toFixed(2)}`);
      }

      const laborCost = Number(BUILDER.laborCost || 0);
      const baseCost = materialCost + laborCost;

      const profit = baseCost * PROFIT_RATE;
      const finalExact = baseCost + profit;
      const finalRounded = roundTo(finalExact, ROUND_TO);

      // === UI summary ===
      const spacerText = SPACERS[spacerKey]?.name || "Sin separadores";
      const note = (bNote.value || "").trim();

      const designText = sequenceActive
        ? `Modo secuencia: ${sequenceToLabel(seqIds)}`
        : `${main.name} ¬∑ Acento: ${accent ? `${accent.name} (${accentPctEff}%)` : "Sin acento"}`;

      bSummary.innerHTML =
        `<b>Tu dise√±o:</b> ${designText} ¬∑ ${beadMm}mm ¬∑ ${lengthCm}cm ¬∑ ${total} posiciones (${baseCount} cuentas + ${spacerUsed} separadores) ¬∑ Separador: ${spacerText}` +
        (note ? `<br><b>Nota:</b> ${note}` : "");

      bPricing.innerHTML =
        `<b>Costo material:</b> S/ ${materialCost.toFixed(2)}`
        + (laborCost > 0 ? ` ¬∑ <b>Mano de obra:</b> S/ ${laborCost.toFixed(2)}` : "")
        + ` ¬∑ <b>Ganancia 18%:</b> S/ ${profit.toFixed(2)}`
        + ` ¬∑ <b>Precio sugerido:</b> <span style="color:#1a1408;font-weight:950">S/ ${finalRounded.toFixed(2)}</span>`
        + ` <span style="opacity:.8">(exacto: S/ ${finalExact.toFixed(2)})</span>`
        + `<br><span style="display:block;margin-top:6px">${detailLines.join("<br>")}</span>`;

      // render
      renderBracelet({ total, beadMm, plan, spacerKey });

      // === WhatsApp message ===
      const seqLine = sequenceActive
        ? `‚Ä¢ Secuencia: ${sequenceToLabel(seqIds)}\n`
        : `‚Ä¢ Principal: ${main.name}\n‚Ä¢ Acento: ${accent ? `${accent.name} (${accentPctEff}%)` : "Sin acento"}\n`;

      const stonesBreak = Array.from(stoneCounts.entries())
        .map(([id,c]) => `- ${getStone(id).name}: ${c} cuentas`)
        .join("\n");

      const msg =
`Hola üòä Quiero una pulsera personalizada Gaia Craft:

${seqLine}‚Ä¢ Tama√±o de cuentas: ${beadMm} mm
‚Ä¢ Largo: ${lengthCm} cm
‚Ä¢ Separadores: ${spacerText}

Material usado:
${stonesBreak}
${spacerUsed ? `- Separadores: ${spacerUsed}\n` : ""}

Costos:
- Material: S/ ${materialCost.toFixed(2)}
${laborCost ? `- Mano de obra: S/ ${laborCost.toFixed(2)}\n` : ""}- Ganancia (18%): S/ ${profit.toFixed(2)}
- Precio sugerido: S/ ${finalRounded.toFixed(2)}

${note ? "Nota: " + note + "\n" : ""}¬øMe confirmas precio final y stock?`;

      bWA.href = waLink(msg);
    }

    // listeners
    [bMainStone, bAccentStone, bBeadSize, bLength, bSpacer].forEach(el => el.addEventListener("change", builderUpdate));
    bAccentPercent.addEventListener("input", builderUpdate);
    bNote.addEventListener("input", builderUpdate);
    bSequence.addEventListener("input", builderUpdate);

    bRandom.addEventListener("click", ()=>{
      // en aleatorio, tambi√©n genera una secuencia de vez en cuando
      const useSeq = Math.random() < 0.55;

      if(useSeq){
        const len = [2,3,3,4][Math.floor(Math.random()*4)];
        const seq = [];
        for(let i=0;i<len;i++){
          seq.push(STONES[Math.floor(Math.random()*STONES.length)].name);
        }
        bSequence.value = seq.join(" | ");
      } else {
        bSequence.value = "";
      }

      const main = STONES[Math.floor(Math.random()*STONES.length)];
      let accent = Math.random() < 0.65 ? STONES[Math.floor(Math.random()*STONES.length)] : null;
      if(accent && accent.id === main.id) accent = null;

      bMainStone.value = main.id;
      bAccentStone.value = accent ? accent.id : "none";
      bAccentPercent.value = accent ? [10,15,20,25,30][Math.floor(Math.random()*5)] : 15;
      bBeadSize.value = [4,6,8][Math.floor(Math.random()*3)];
      bLength.value = [18,19,20,21][Math.floor(Math.random()*4)];
      bSpacer.value = ["none","gold","silver"][Math.floor(Math.random()*3)];
      bNote.value = "";

      builderUpdate();
    });

    bReset.addEventListener("click", ()=>{
      bSequence.value = "";
      bMainStone.value = "blue_tiger";
      bAccentStone.value = "none";
      bAccentPercent.value = 15;
      bBeadSize.value = 4;
      bLength.value = 18;
      bSpacer.value = "none";
      bNote.value = "";
      builderUpdate();
    });

    // init
    builderUpdate();
    preloadTextures();
  </script>
</body>
</html>

